<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Intermediate Example · RetirementPlanners</title><meta name="title" content="Intermediate Example · RetirementPlanners"/><meta property="og:title" content="Intermediate Example · RetirementPlanners"/><meta property="twitter:title" content="Intermediate Example · RetirementPlanners"/><meta name="description" content="Documentation for RetirementPlanners."/><meta property="og:description" content="Documentation for RetirementPlanners."/><meta property="twitter:description" content="Documentation for RetirementPlanners."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="RetirementPlanners logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">RetirementPlanners</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../basic_example/">Basic Example</a></li><li class="is-active"><a class="tocitem" href>Intermediate Example</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Example"><span>Example</span></a></li><li><a class="tocitem" href="#Load-Packages"><span>Load Packages</span></a></li><li><a class="tocitem" href="#Create-Model"><span>Create Model</span></a></li><li><a class="tocitem" href="#Configure-Update-Options"><span>Configure Update Options</span></a></li><li><a class="tocitem" href="#Setup-Logger"><span>Setup Logger</span></a></li><li><a class="tocitem" href="#Run-Simulation"><span>Run Simulation</span></a></li></ul></li><li><a class="tocitem" href="../advanced_example/">Advanced Example</a></li></ul></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Intermediate Example</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Intermediate Example</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/itsdfish/RetirementPlanners.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/itsdfish/RetirementPlanners.jl/blob/main/docs/src/intermediate_example.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h1><p>This example builds upon the <a href="../basic_example/">basic example</a> and attempts to overcome some of its limitations. The primary limitation with the basic example is that it lacked the means to capture uncertainy in future events, such as interest rates, and the amount withdrawn from investments during retirement. To capture the inherent uncertainty of future events, we will sample these quantities from specified distributions. In so doing, we will be able to stress test the retirement plan under a wide variety of uncertain scenarios to determine the survival probability as a function of time. This will allow us to answer questions, such as <em>what is the chance of running out of money after 20 years?</em></p><h1 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h1><h2 id="Load-Packages"><a class="docs-heading-anchor" href="#Load-Packages">Load Packages</a><a id="Load-Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Load-Packages" title="Permalink"></a></h2><p>The first step is to load the packages required for simulating a retirement scenario and analyzing the results. In the code block below, we will load <code>RetirementPlanners</code> to run the simulation, <code>Distributions</code> to make the simulation stochastic, and <code>Plots</code> to plot the results of the simulation. </p><pre><code class="language-julia hljs">using Distributions
using Plots
using RetirementPlanners</code></pre><h2 id="Create-Model"><a class="docs-heading-anchor" href="#Create-Model">Create Model</a><a id="Create-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Model" title="Permalink"></a></h2><p>The <code>Model</code> object defines the parameters and behavior of the retirement investment simulation. As in the basic example, you must enter a value for the following keyword parameters:</p><ul><li><code>Δt</code>: the time step in years </li><li><code>start_age</code>: the age of the person at the beginning of the simulation</li><li><code>duration</code>: the number of years to simulate</li><li><code>start_amount</code>: the amount of money in investments at the beginning of the simulation</li></ul><p>In this example, we will use the same timing paramers used in the basic example: we will assume you start saving for retirement at age 25 with a modest initial amount of <code>$</code>10,000. The simulation will update on a monthy basis and continue for 55 years until you reach age 80. </p><pre><code class="language-julia hljs">model = Model(;
    Δt = 1 / 12,
    start_age = 25,
    duration = 55,
    start_amount = 10_000,
    withdraw! = variable_withdraw,
    invest! = variable_investment,
    update_income! = fixed_income,
    update_inflation! = variable_inflation,
    update_interest! = variable_interest
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">Model
┌───────────────────┬─────────────────────────────────────┐
│ Field             │ Value                               │
├───────────────────┼─────────────────────────────────────┤
│ Δt                │  0.08                               │
│ duration          │ 55.00                               │
│ start_age         │ 25.00                               │
│ start_amount      │ 10000.00                            │
│ state             │ State(0.0, 0.0, 0.0, 0.0, 0.0, 0.0) │
│ withdraw!         │ variable_withdraw                   │
│ invest!           │ variable_investment                 │
│ update_income!    │ fixed_income                        │
│ update_inflation! │ variable_inflation                  │
│ update_interest!  │ variable_interest                   │
│ update_net_worth! │ default_net_worth                   │
│ log!              │ default_log!                        │
└───────────────────┴─────────────────────────────────────┘
</span></code></pre><p>The function names are prefixed with <code>variable</code> to signify that they allow us to introduce variability in the simulation behavior by sampling relevant quantities from distributions specified by the user. The distribution can be any univariate distribution defined in <a href="https://juliastats.org/Distributions.jl/stable/">Distributions.jl</a>. In cases where the desired distribution is not available in <code>Distributions.jl</code>, you may use their API to create custom distribution types. You can find more details on these update functions in the <a href="../api/">API</a> or by typing <code>? function_name</code> in the the REPL. </p><h2 id="Configure-Update-Options"><a class="docs-heading-anchor" href="#Configure-Update-Options">Configure Update Options</a><a id="Configure-Update-Options-1"></a><a class="docs-heading-anchor-permalink" href="#Configure-Update-Options" title="Permalink"></a></h2><p>We will specify the parameters of the update function in a nested configuration data structure, which passes keyword arguments to their corresponding update funtions. The configuration data structure is a nested <code>NamedTuple</code> (i.e., immutable keyword-value pairs), where the keywords in the first level correspond to the keyword inputs of the update functions. For example, the keyword <code>kw_invest</code> (short for keyword invest) is a set of keywords passed to the function <code>fixed_investment</code>.</p><p>The configuration data structure below defines distributions over quanties, such as investment and withdraw amount. Aside from drawling random values from probability distributions, the simulation is the same as that described in the <a href="../basic_example/">basic example</a>.</p><p>The mean monthly investment follows a normal distribution with a mean of <code>$2,000</code> and a standard deviation of <code>$500</code> to reflect fluctuations in income and expenses. As before, investments are made until an early retirement at age 40. The yearly interest rate on investments has a mean of <code>.08</code> with a large standard deviation of <code>.08</code> to reflect inherent volitility in the stock market. The yearly inflation rate has a mean of <code>.035</code> and a standard deviation of <code>.015</code>. Upon retirement at age 40, we assume that you withdraw <code>$2,200</code> per month with a standard deviation of <code>$500</code> to reflect fluctuation in monthly expenses. </p><pre><code class="language-julia hljs">config = (
    # invest parameters
    kw_invest = (
        distribution = Normal(2000, 500),
        end_age = 40,
    ),
    # interest parameters
    kw_interest = (
        distribution = Normal(.08, .08),
    ),
    # inflation parameters
    kw_inflation = (
        distribution = Normal(.035, .015),
    ),
    # withdraw parameters
    kw_withdraw = (
        distribution = Normal(2200, 500),
        start_age = 40,
    )
)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(kw_invest = (distribution = Distributions.Normal{Float64}(μ=2000.0, σ=500.0), end_age = 40), kw_interest = (distribution = Distributions.Normal{Float64}(μ=0.08, σ=0.08),), kw_inflation = (distribution = Distributions.Normal{Float64}(μ=0.035, σ=0.015),), kw_withdraw = (distribution = Distributions.Normal{Float64}(μ=2200.0, σ=500.0), start_age = 40))</code></pre><h2 id="Setup-Logger"><a class="docs-heading-anchor" href="#Setup-Logger">Setup Logger</a><a id="Setup-Logger-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-Logger" title="Permalink"></a></h2><p>The next step is to initialize the data logger. On each time step, the data logger stores the following quantities: annualized interest rate, annualized inflation rate, and net worth. The <code>Logger</code> object requires two inputs: <code>n_steps</code>: the total number of time steps in one simulation, and <code>n_reps</code>: the total repetitions of the simulation. The total number of time steps can be found by getting the length of the time steps. In this simple scenario, we will repeat the simulation <code>10,000</code> times to provide a stable estimate of the variability in the investment and retirement conditions. </p><pre><code class="language-julia hljs">times = get_times(model)
n_steps = length(times)
n_reps = 10_000
logger = Logger(;n_reps, n_steps)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr1">Logger
┌───────────┬───────────────────────────────────────────────────────────────────
│ Field     │ Value                                                            ⋯
├───────────┼───────────────────────────────────────────────────────────────────
│ net_worth │ [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0. ⋯
│ interest  │ [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0. ⋯
│ inflation │ [0.0 0.0 … 0.0 0.0; 0.0 0.0 … 0.0 0.0; … ; 0.0 0.0 … 0.0 0.0; 0. ⋯
└───────────┴───────────────────────────────────────────────────────────────────
<span class="sgr36">                                                                1 column omitted
</span></span></code></pre><h2 id="Run-Simulation"><a class="docs-heading-anchor" href="#Run-Simulation">Run Simulation</a><a id="Run-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Run-Simulation" title="Permalink"></a></h2><p>Now that we have specified the parameters of the simulation, we can use the function <code>simulate!</code> to generate retirement numbers and save them to the <code>Logger</code> object. As shown below, <code>simulate!</code> requires our model object, the logger, and the number of repetitions. The optional configuration object is passed as a variable keyword using <code>; config...</code>, which maps the nested keywords in the <code>NamedTuple</code> to the corresponding keywords defined in the <code>simulate!</code> method signature. </p><pre><code class="language-julia hljs">simulate!(model, logger, n_reps; config...)</code></pre><p>One of the biggest changes from the basic example is the use of random values for withdraw and interest. In the code block below, we will use the function <code>plot_gradient</code> to represent variability in networth projections. Darker values correspond to higher density or more likely trajectories.   </p><pre><code class="language-julia hljs">plot_gradient(times, logger.net_worth; xlabel=&quot;Age&quot;, ylabel=&quot;Net Worth&quot;)</code></pre><img src="a26090e3.svg" alt="Example block output"/><p>Two patterns are appearent. First, the trajectories become more uncertain the further we project into the future, owing to the fact that variance grows according to the <a href="https://web.pdx.edu/~joel8/resources/ConceptualPresentationResources/VarianceSumLaw.pdf">variance sum law</a>. Second, there is a qualitative shift at the onset of retirement in which networth decreases and becomes more uncertain.</p><p>One way to assess the robustness of a retirement plan is to compute the probability of <em>survival</em> (e.g., having net worth greater than zero) at each time point. The code block below illustrates how to compute and plot the survival probability.</p><pre><code class="language-julia hljs">survival_probs = mean(logger.net_worth .&gt; 0, dims=2)
plot(times, survival_probs, leg=false, grid=false, xlabel=&quot;Age (years)&quot;,
    ylabel=&quot;Survival Probability&quot;, ylims = (0,1.05))</code></pre><img src="4d334be3.svg" alt="Example block output"/><p>The plot above reveals that the survival probability drops rapidly around age 70, reaching about 25% at age 80. Depending on your life expectancy and risk tolerance, you might want to adjust some parameters of your retirement plan: perhaps working more years and/or investing more money.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../basic_example/">« Basic Example</a><a class="docs-footer-nextpage" href="../advanced_example/">Advanced Example »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Saturday 10 February 2024 10:04">Saturday 10 February 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
