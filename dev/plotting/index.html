<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plotting · RetirementPlanners</title><meta name="title" content="Plotting · RetirementPlanners"/><meta property="og:title" content="Plotting · RetirementPlanners"/><meta property="twitter:title" content="Plotting · RetirementPlanners"/><meta name="description" content="Documentation for RetirementPlanners."/><meta property="og:description" content="Documentation for RetirementPlanners."/><meta property="twitter:description" content="Documentation for RetirementPlanners."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="RetirementPlanners logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">RetirementPlanners</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../basic_example/">Basic Example</a></li><li><a class="tocitem" href="../advanced_example/">Advanced Example</a></li><li><a class="tocitem" href="../custom_example/">Custom Example</a></li></ul></li><li class="is-active"><a class="tocitem" href>Plotting</a><ul class="internal"><li><a class="tocitem" href="#Gradient-Plot"><span>Gradient Plot</span></a></li><li><a class="tocitem" href="#Sensitivity-Plot"><span>Sensitivity Plot</span></a></li></ul></li><li><a class="tocitem" href="../notebook/">Notebook</a></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Plotting</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plotting</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/itsdfish/RetirementPlanners.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/itsdfish/RetirementPlanners.jl/blob/main/docs/src/plotting.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Plotting-Support"><a class="docs-heading-anchor" href="#Plotting-Support">Plotting Support</a><a id="Plotting-Support-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Support" title="Permalink"></a></h1><p>Currently, <code>RetirementPlanners.jl</code> provides two specialized plotting functions: <code>plot_gradient</code> and <code>plot_sensitivity</code>. Each plotting function is illustrated below using the code detailed in the <a href="../basic_example/">basic example</a> and the <a href="../advanced_example/">advanced example</a>. For ease of presentation, only key elements of the code are visible by default. The code to setup the simulation can be revealed by clicking on the arrow button. </p><h2 id="Gradient-Plot"><a class="docs-heading-anchor" href="#Gradient-Plot">Gradient Plot</a><a id="Gradient-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Gradient-Plot" title="Permalink"></a></h2><p>The function <code>plot_gradient</code> is used to plot the distribution of a quantity across time. Some examples include, net worth and total income. This functionality is useful in cases involving thousands of simulations, which would lead to overplotting. <code>plot_gradient</code> overcomes this challenge by representing variability as a density gradient, where darker regions correspond to more likely trajectories. <code>plot_gradient</code> is conditionally loaded into your active session when <code>RetirementPlanners</code> and <code>Plots</code> are loaded. The example below shows a gradient density plot for 1000 simulations. The full set of code can be seen by expanding the hidden code under <em>Show Code</em>.</p><details>
<summary><b>Show Code</b></summary><pre><code class="language-julia hljs">using Distributions
using Plots
using RetirementPlanners

# montly contribution
contribution = (50_000 / 12) * 0.15
# configuration options
config = (
    # time step in years
    Δt = 1 / 12,
    # start age of simulation
    start_age = 27,
    # duration of simulation in years
    duration = 58,
    # initial investment amount
    start_amount = 10_000,
    # withdraw parameters
    kw_withdraw = (withdraws = Transaction(;
        start_age = 60,
        amount = AdaptiveWithdraw(;
            min_withdraw = 2200,
            percent_of_real_growth = 0.15,
            income_adjustment = 0.0,
            volitility = 0.05
        )
    ),),
    # invest parameters
    kw_invest = (investments = Transaction(;
        start_age = 27,
        end_age = 60,
        amount = Normal(contribution, 100)
    ),),
    # interest parameters
    kw_market = (
        # dynamic model of the stock market
        gbm = VarGBM(;
            # non-recession parameters
            αμ = 0.070,
            ημ = 0.010,
            ασ = 0.035,
            ησ = 0.010,
            # recession parameters
            αμᵣ = -0.05,
            ημᵣ = 0.010,
            ασᵣ = 0.035,
            ησᵣ = 0.010
        ),
        recessions = Transaction(; start_age = 0, end_age = 0)
    ),
    # inflation parameters
    kw_inflation = (gbm = VarGBM(; αμ = 0.035, ημ = 0.005, ασ = 0.005, ησ = 0.0025),),
    # income parameters
    kw_income = (income_sources = Transaction(; start_age = 67, amount = 2000),)
)
# setup retirement model
model = Model(; config...)
times = get_times(model)
n_reps = 1000
n_steps = length(times)
logger = Logger(; n_steps, n_reps)
simulate!(model, logger, n_reps)

# plot of survival probability as a function of time
survival_probs = mean(logger.net_worth .&gt; 0, dims = 2)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">696×1 Matrix{Float64}:
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 1.0
 ⋮
 0.595
 0.594
 0.592
 0.591
 0.589
 0.588
 0.588
 0.586
 0.585</code></pre></details><pre><code class="language-julia hljs">income_plot = plot_gradient(
    times,
    logger.total_income;
    xlabel = &quot;Age&quot;,
    ylabel = &quot;Total Income&quot;,
    xlims = (config.kw_withdraw.withdraws.start_age, times[end]),
    n_lines = 0,
    color = :blue
)</code></pre><img src="f511e482.svg" alt="Example block output"/><h2 id="Sensitivity-Plot"><a class="docs-heading-anchor" href="#Sensitivity-Plot">Sensitivity Plot</a><a id="Sensitivity-Plot-1"></a><a class="docs-heading-anchor-permalink" href="#Sensitivity-Plot" title="Permalink"></a></h2><p>In many cases, it is informative to perform a sensitivity analysis of your retirement strategy. For example, you might want to know to what extent your net worth varies according to changes in investment amount and number of years investing. The function <code>plot_sensitivity</code> uses a contour plot visualize the effect of two variables on another variable.</p><p>In the code block below, invest amount and number of years investing are varied independently across a range of values and the survival probability at the end of the simulation is color coded from low in red to high in green. As you might expect, you are more likely run out of money by withdrawing more and investing less. The benefit of a sensitivity analysis is that it provides details about the magnitude of these changes. </p><p>As shown in the configuration below, we specificy a vector of values for the variables we wish to vary. The configuration is passed to a function called <code>grid_search</code>, which runs the simulation for all combinations of the two variables. Click the arrow to reveal the details. </p><pre><code class="language-julia hljs"># montly contribution 
contribute(x, r) = (x / 12) * r
salary = 50_000

withdraws = map(
    a -&gt; Transaction(;
        start_age = a,
        amount = AdaptiveWithdraw(;
            min_withdraw = 2200,
            percent_of_real_growth = 0.15,
            income_adjustment = 0.0,
            volitility = 0.05
        )
    ),
    55:65
)

investments = [
    Transaction(; start_age = 27, end_age = a, amount = Normal(contribute(5e4, p), 100))
    for p ∈ 0.10:0.05:0.30 for a ∈ 55:65
]

# configuration options
config = (
    log_times = 70:5:85,
    # time step in years 
    Δt = 1 / 12,
    # start age of simulation 
    start_age = 27,
    # duration of simulation in years
    duration = 58,
    # initial investment amount 
    start_amount = 10_000,
    # withdraw parameters 
    kw_withdraw = (; withdraws),
    # invest parameters
    kw_invest = (; investments),
    # interest parameters
    kw_market = (gbm = VarGBM(; αμ = 0.070, ημ = 0.010, ασ = 0.035, ησ = 0.010),),
    # inflation parameters
    kw_inflation = (gbm = VarGBM(; αμ = 0.035, ημ = 0.005, ασ = 0.005, ησ = 0.0025),),
    # income parameters 
    kw_income = (income_sources = Transaction(; start_age = 67, amount = 2000),)
)</code></pre><details>
<summary><b>Show Code</b></summary><pre><code class="language-julia hljs">using DataFrames
using Distributions
using Random
using RetirementPlanners
using StatsPlots

Random.seed!(6522)
# montly contribution
contribute(x, r) = (x / 12) * r
salary = 50_000

withdraws = map(
    a -&gt; Transaction(;
        start_age = a,
        amount = AdaptiveWithdraw(;
            min_withdraw = 2200,
            percent_of_real_growth = 0.15,
            income_adjustment = 0.0,
            volitility = 0.05
        )
    ),
    55:65
)

investments = [
    Transaction(; start_age = 27, end_age = a, amount = Normal(contribute(5e4, p), 100))
    for p ∈ 0.10:0.05:0.30 for a ∈ 55:65
]

# configuration options
config = (
    log_times = 70:5:85,
    # time step in years
    Δt = 1 / 12,
    # start age of simulation
    start_age = 27,
    # duration of simulation in years
    duration = 58,
    # initial investment amount
    start_amount = 10_000,
    # withdraw parameters
    kw_withdraw = (; withdraws),
    # invest parameters
    kw_invest = (; investments),
    # interest parameters
    kw_market = (gbm = VarGBM(; αμ = 0.070, ημ = 0.010, ασ = 0.035, ησ = 0.010),),
    # inflation parameters
    kw_inflation = (gbm = VarGBM(; αμ = 0.035, ημ = 0.005, ασ = 0.005, ησ = 0.0025),),
    # income parameters
    kw_income = (income_sources = Transaction(; start_age = 67, amount = 2000),)
)

yoked_values =
    [Pair((:kw_withdraw, :withdraws, :start_age), (:kw_invest, :investments, :end_age))]
results = grid_search(Model, Logger, 1000, config; yoked_values);
df = to_dataframe(Model(; config...), results)
df.survived = df.net_worth .&gt; 0
df.retirement_age = map(x -&gt; x.end_age, df.invest_investments)
df.mean_investment = map(x -&gt; x.amount.μ, df.invest_investments)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">220000-element Vector{Float64}:
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
  416.66666666666674
    ⋮
 1250.0
 1250.0
 1250.0
 1250.0
 1250.0
 1250.0
 1250.0
 1250.0
 1250.0</code></pre></details><pre><code class="language-julia hljs">plot_sensitivity(
    df,
    [:retirement_age, :mean_investment],
    :survived,
    xlabel = &quot;Age&quot;,
    ylabel = &quot;Invest Amount&quot;,
    colorbar_title = &quot;Surival Probability&quot;
)</code></pre><img src="04b9ecf9.svg" alt="Example block output"/><p>The example below shows how to make a grid of plots at multiple time points by passing a vector or unit range to the <code>age</code> keyword. To ensure each subplot has the same scale, pass lower and upper bounds to the <code>clims</code> keyword.</p><pre><code class="language-julia hljs">plot_sensitivity(
    df,
    [:retirement_age, :mean_investment],
    :survived,
    xlabel = &quot;Age&quot;,
    ylabel = &quot;Invest Amount&quot;,
    colorbar_title = &quot;Surival Probability&quot;,
    colorbar = false,
    clims = (0, 1),
    age = 70:5:85
)</code></pre><img src="e33b1b92.svg" alt="Example block output"/><details>
<summary><b>All Code</b></summary><pre><code class="language-julia hljs">###############################################################################################################
#                                           load dependencies
###############################################################################################################
cd(@__DIR__)
using Pkg
Pkg.activate(&quot;..&quot;)
using Distributions
using DataFrames
using Plots
using RetirementPlanners
using StatsPlots
###############################################################################################################
#                                           setup simulation
###############################################################################################################
# montly contribution 
contribute(x, r) = (x / 12) * r
salary = 50_000

withdraws = map(
    a -&gt; Transaction(;
        start_age = a,
        amount = AdaptiveWithdraw(;
            min_withdraw = 2200,
            percent_of_real_growth = 0.15,
            income_adjustment = 0.0,
            volitility = 0.05
        )
    ),
    55:65
)

investments = [
    Transaction(; start_age = 27, end_age = a, amount = Normal(contribute(5e4, p), 100))
    for p ∈ 0.10:0.05:0.30 for a ∈ 55:65
]

# configuration options
config = (
    # time step in years 
    Δt = 1 / 12,
    # start age of simulation 
    start_age = 27,
    # duration of simulation in years
    duration = 58,
    # initial investment amount 
    start_amount = 10_000,
    # withdraw parameters 
    kw_withdraw = (; withdraws),
    # invest parameters
    kw_invest = (; investments),
    # interest parameters
    kw_market = (
        gbm = VarGBM(;
            αμ = 0.070,
            ημ = 0.010,
            ασ = 0.035,
            ησ = 0.010,
            αμᵣ = -0.05,
            ημᵣ = 0.010,
            ασᵣ = 0.035,
            ησᵣ = 0.010
        ),
        Transaction(; start_age = 0, end_age = 0)
    ),
    # inflation parameters
    kw_inflation = (gbm = VarGBM(; αμ = 0.035, ημ = 0.005, ασ = 0.005, ησ = 0.0025),),
    # income parameters 
    kw_income = (income_sources = Transaction(; start_age = 67, amount = 2000),)
)
###############################################################################################################
#                                           run simulation
###############################################################################################################
yoked_values =
    [Pair((:kw_withdraw, :withdraws, :start_age), (:kw_invest, :investments, :end_age))]
results = grid_search(Model, Logger, 1000, config; yoked_values);
df = to_dataframe(Model(; config...), results)
df.survived = df.net_worth .&gt; 0
df.retirement_age = map(x -&gt; x.end_age, df.invest_investments)
df.mean_investment = map(x -&gt; x.amount.μ, df.invest_investments)
df1 = combine(groupby(df, [:retirement_age, :mean_investment, :time]), :net_worth =&gt; mean)
df2 = combine(groupby(df, [:retirement_age, :mean_investment, :time]), :survived =&gt; mean)
###############################################################################################################
#                                            plot results 
###############################################################################################################
@df df1 plot(
    :time,
    :net_worth_mean,
    group = (:retirement_age, :mean_investment),
    ylims = (0, 2e6),
    legend = false,
    legendtitle = &quot;withdraw age&quot;,
    grid = false,
    xlabel = &quot;Age&quot;,
    ylabel = &quot;Mean Net Worth&quot;
)

@df df2 plot(
    :time,
    :survived_mean,
    group = (:retirement_age, :mean_investment),
    ylims = (0, 1),
    grid = false,
    xlabel = &quot;Age&quot;,
    layout = (4, 1),
    legend = :bottomleft,
    ylabel = &quot;Survival Probability&quot;
)

plot_sensitivity(
    df,
    [:retirement_age, :mean_investment],
    :survived,
    xlabel = &quot;Age&quot;,
    ylabel = &quot;Invest Amount&quot;,
    colorbar_title = &quot;Surival Probability&quot;
)</code></pre></details><p>As shown below, you can also create a grid of contour plots in which the rows correspond to a variable of interest and the columns correspond to specified time points. </p><pre><code class="language-julia hljs">income_plots = plot_sensitivity(
    df,
    [:retirement_age, :mean_investment],
    :total_income,
    :mean_growth_rate;
    row_label = &quot;growth:&quot;,
    xlabel = &quot;Retirement Age&quot;,
    ylabel = &quot;Invest Amount&quot;,
    colorbar_title = &quot;Mean Total Income&quot;,
    clims = (2000, 6000),
    age = 70:5:85,
    size = (1200, 600)
)</code></pre><p>The complete code for this example can be found below by expanding the tab labeled <em>All Code</em>.</p><p><img src="../assets/income_sensitivity.png" alt/></p><details>
<summary><b>All Code</b></summary><pre><code class="language-julia hljs">###############################################################################################################
#                                           load dependencies
###############################################################################################################
cd(@__DIR__)
using Pkg
Pkg.activate(&quot;..&quot;)
using Distributions
using DataFrames
using Plots
using RetirementPlanners
using Revise
using StatsPlots
###############################################################################################################
#                                           setup simulation
###############################################################################################################
# montly contribution 
contribute(x, r) = (x / 12) * r
# enter your salary here
salary = 150_000

# withdraws = map(
#     a -&gt; Transaction(;
#         start_age = a,
#         amount = Normal(2200, 200)
#     ),
#     55:65
# )

withdraws = map(
    a -&gt; Transaction(;
        start_age = a,
        amount = AdaptiveWithdraw(;
            min_withdraw = 2200,
            percent_of_real_growth = 0.15,
            income_adjustment = 0.0,
            volitility = 0.05
        )
    ),
    55:65
)

investments = [
    Transaction(; start_age = 49, end_age = a, amount = Normal(contribute(salary, p), 100))
    for p ∈ 0.10:0.05:0.30 for a ∈ 55:65
]

gbm = map(
    αμ -&gt; VarGBM(;
        αμ,
        ημ = 0.010,
        ασ = 0.035,
        ησ = 0.010,
        αμᵣ = -0.05,
        ημᵣ = 0.010,
        ασᵣ = 0.035,
        ησᵣ = 0.010
    ),
    0.05:0.025:0.10
)

# configuration options
config = (
    # time step in years 
    Δt = 1 / 12,
    # start age of simulation 
    start_age = 49,
    # duration of simulation in years
    duration = 40,
    # initial investment amount 
    start_amount = 300_000,
    # withdraw parameters 
    kw_withdraw = (; withdraws),
    # invest parameters
    kw_invest = (; investments),
    # interest parameters
    kw_market = (; gbm,),
    # inflation parameters
    kw_inflation = (gbm = VarGBM(; αμ = 0.035, ημ = 0.005, ασ = 0.005, ησ = 0.0025),),
    # income parameters 
    kw_income = (income_sources = Transaction(; start_age = 67, amount = 2000),)
)
###############################################################################################################
#                                           run simulation
###############################################################################################################
n_reps = 1000
yoked_values =
    [Pair((:kw_withdraw, :withdraws, :start_age), (:kw_invest, :investments, :end_age))]
results = grid_search(Model, Logger, n_reps, config; yoked_values);
df = to_dataframe(Model(; config...), results)
df.survived = df.net_worth .&gt; 0
df.retirement_age = map(x -&gt; x.end_age, df.invest_investments)
df.mean_investment = map(x -&gt; x.amount.μ, df.invest_investments)
df.mean_growth_rate = map(x -&gt; x.αμ, df.market_gbm)
###############################################################################################################
#                                            plot results 
###############################################################################################################
@time survival_plots = plot_sensitivity(
    df,
    [:retirement_age, :mean_investment],
    :survived,
    :mean_growth_rate;
    row_label = &quot;growth:&quot;,
    xlabel = &quot;Retirement Age&quot;,
    ylabel = &quot;Invest Amount&quot;,
    clims = (0, 1),
    colorbar_title = &quot;Survival Probability&quot;,
    age = 70:5:85,
    size = (1200, 600)
)

income_plots = plot_sensitivity(
    df,
    [:retirement_age, :mean_investment],
    :total_income,
    :mean_growth_rate;
    row_label = &quot;growth:&quot;,
    xlabel = &quot;Retirement Age&quot;,
    ylabel = &quot;Invest Amount&quot;,
    colorbar_title = &quot;Mean Total Income&quot;,
    clims = (2000, 6000),
    age = 70:5:85,
    size = (1200, 600)
)</code></pre></details></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../custom_example/">« Custom Example</a><a class="docs-footer-nextpage" href="../notebook/">Notebook »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.1 on <span class="colophon-date" title="Friday 21 June 2024 21:05">Friday 21 June 2024</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
